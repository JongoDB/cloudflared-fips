import type { ChecklistSection, BuildManifest } from '../types/compliance'

export const mockSections: ChecklistSection[] = [
  {
    id: 'client-posture',
    name: 'Client Posture',
    description: 'Device trust, WARP client, and endpoint compliance for the client-to-edge segment',
    items: [
      {
        id: 'cp-1',
        name: 'WARP Client Deployed',
        status: 'pass',
        severity: 'critical',
        what: 'Cloudflare WARP client is installed and running on endpoint devices',
        why: 'WARP establishes the encrypted tunnel from client to Cloudflare edge, enforcing device posture policies',
        remediation: 'Deploy WARP client via MDM (Jamf, Intune, etc.) with managed configuration profile',
        nistRef: 'SC-8, SC-13',
      },
      {
        id: 'cp-2',
        name: 'WARP TLS Inspection Enabled',
        status: 'pass',
        severity: 'high',
        what: 'WARP client has TLS inspection enabled with custom root CA installed',
        why: 'Enables Gateway to inspect encrypted traffic for threats and data loss prevention',
        remediation: 'Install Cloudflare root certificate on endpoints and enable TLS inspection in WARP profile',
        nistRef: 'SC-8(1), SI-4',
      },
      {
        id: 'cp-3',
        name: 'Device Posture Checks Active',
        status: 'pass',
        severity: 'high',
        what: 'Device posture checks (OS version, disk encryption, firewall) are configured and enforced',
        why: 'Ensures only compliant devices can access protected resources via Zero Trust policies',
        remediation: 'Configure device posture rules in Cloudflare Zero Trust dashboard under Settings > WARP Client',
        nistRef: 'IA-3, CM-6',
      },
      {
        id: 'cp-4',
        name: 'Client Certificate Authentication',
        status: 'warning',
        severity: 'medium',
        what: 'Mutual TLS (mTLS) client certificates are deployed for service authentication',
        why: 'Provides cryptographic device identity beyond user credentials',
        remediation: 'Issue client certificates from a FIPS-compliant CA and configure mTLS policies in Access',
        nistRef: 'IA-2(12), SC-8',
      },
      {
        id: 'cp-5',
        name: 'FIPS-Compliant Client Crypto',
        status: 'pass',
        severity: 'critical',
        what: 'Client cryptographic operations use FIPS 140-2 validated modules',
        why: 'Federal agencies require FIPS-validated cryptography for all data in transit',
        remediation: 'Enable FIPS mode on endpoint OS; verify WARP uses system FIPS crypto providers',
        nistRef: 'SC-13, IA-7',
      },
      {
        id: 'cp-6',
        name: 'Endpoint Disk Encryption',
        status: 'pass',
        severity: 'high',
        what: 'Full disk encryption is enabled on endpoint devices (BitLocker/FileVault)',
        why: 'Protects data at rest if devices are lost or stolen',
        remediation: 'Enforce disk encryption via MDM policy and add as device posture check',
        nistRef: 'SC-28, MP-5',
      },
      {
        id: 'cp-7',
        name: 'OS Firewall Enabled',
        status: 'pass',
        severity: 'medium',
        what: 'Host-based firewall is enabled and configured on endpoint devices',
        why: 'Provides defense-in-depth by restricting network access at the endpoint',
        remediation: 'Enable OS firewall via MDM policy and configure as device posture requirement',
        nistRef: 'SC-7, CM-6',
      },
      {
        id: 'cp-8',
        name: 'Automatic Updates Enabled',
        status: 'warning',
        severity: 'medium',
        what: 'Endpoint OS and WARP client are configured for automatic security updates',
        why: 'Ensures known vulnerabilities are patched promptly',
        remediation: 'Configure automatic update policies via MDM; set minimum OS version posture check',
        nistRef: 'SI-2, CM-3',
      },
    ],
  },
  {
    id: 'cloudflare-edge',
    name: 'Cloudflare Edge',
    description: 'Cloudflare network edge configuration including Access policies, Gateway rules, and key management',
    items: [
      {
        id: 'ce-1',
        name: 'Access Policies Configured',
        status: 'pass',
        severity: 'critical',
        what: 'Cloudflare Access policies enforce identity-based access to protected applications',
        why: 'Zero Trust access control replaces VPN with per-application identity verification',
        remediation: 'Configure Access applications and policies in the Cloudflare Zero Trust dashboard',
        nistRef: 'AC-3, AC-17',
      },
      {
        id: 'ce-2',
        name: 'Gateway DNS Filtering',
        status: 'pass',
        severity: 'high',
        what: 'Cloudflare Gateway DNS filtering is active with security categories blocked',
        why: 'Prevents connections to known malicious domains and enforces acceptable use',
        remediation: 'Configure Gateway DNS policies to block security threat categories',
        nistRef: 'SC-7, SI-4',
      },
      {
        id: 'ce-3',
        name: 'Gateway HTTP Inspection',
        status: 'pass',
        severity: 'high',
        what: 'Gateway HTTP policies inspect and filter web traffic for threats',
        why: 'Provides inline threat detection, DLP, and policy enforcement for web traffic',
        remediation: 'Enable Gateway HTTP policies with appropriate inspection rules',
        nistRef: 'SI-4, SC-7',
      },
      {
        id: 'ce-4',
        name: 'Edge TLS 1.2+ Enforced',
        status: 'pass',
        severity: 'critical',
        what: 'Minimum TLS version is set to 1.2 for all edge connections',
        why: 'TLS 1.0 and 1.1 have known vulnerabilities and are not FIPS-approved',
        remediation: 'Set minimum TLS version to 1.2 in Cloudflare SSL/TLS settings',
        nistRef: 'SC-8, SC-13',
      },
      {
        id: 'ce-5',
        name: 'Edge FIPS Cipher Suites Only',
        status: 'pass',
        severity: 'critical',
        what: 'Cloudflare edge restricts connections to FIPS-approved cipher suites',
        why: 'Non-FIPS cipher suites (RC4, DES, 3DES) must not be used in federal environments',
        remediation: 'Configure cipher suite restrictions in Cloudflare SSL/TLS settings',
        nistRef: 'SC-13, IA-7',
      },
      {
        id: 'ce-6',
        name: 'DNSSEC Enabled',
        status: 'pass',
        severity: 'high',
        what: 'DNSSEC is enabled for all domains to prevent DNS spoofing',
        why: 'Ensures DNS integrity and authenticity of DNS responses',
        remediation: 'Enable DNSSEC in Cloudflare DNS settings for each domain',
        nistRef: 'SC-20, SC-21',
      },
      {
        id: 'ce-7',
        name: 'Key Management Policies',
        status: 'warning',
        severity: 'high',
        what: 'Cryptographic key rotation and management policies are documented and enforced',
        why: 'FIPS requires formal key management procedures for all cryptographic keys',
        remediation: 'Document key management procedures; configure automatic certificate rotation',
        nistRef: 'SC-12, SC-12(1)',
      },
      {
        id: 'ce-8',
        name: 'Audit Logging Enabled',
        status: 'pass',
        severity: 'high',
        what: 'Cloudflare audit logs are enabled and exported to SIEM',
        why: 'Provides accountability and incident response capability for security events',
        remediation: 'Enable audit logging and configure Logpush to export to your SIEM',
        nistRef: 'AU-2, AU-6',
      },
      {
        id: 'ce-9',
        name: 'DDoS Protection Active',
        status: 'pass',
        severity: 'medium',
        what: 'Cloudflare DDoS protection is active for all protected origins',
        why: 'Availability is a core security requirement under NIST 800-53',
        remediation: 'Verify DDoS protection is enabled in Cloudflare Security settings',
        nistRef: 'SC-5, CP-2',
      },
    ],
  },
  {
    id: 'tunnel',
    name: 'Tunnel (Edge to Origin)',
    description: 'cloudflared tunnel configuration, cipher enforcement, and FIPS crypto module validation',
    items: [
      {
        id: 'tn-1',
        name: 'cloudflared FIPS Build',
        status: 'pass',
        severity: 'critical',
        what: 'cloudflared binary is built with GOEXPERIMENT=boringcrypto for FIPS 140-2 validated cryptography',
        why: 'BoringCrypto (cert #4407) provides FIPS 140-2 Level 1 validated crypto primitives',
        remediation: 'Rebuild cloudflared using the FIPS build pipeline (make build-fips)',
        nistRef: 'SC-13, IA-7',
      },
      {
        id: 'tn-2',
        name: 'BoringCrypto Symbols Verified',
        status: 'pass',
        severity: 'critical',
        what: '_goboringcrypto_ symbols are present in the compiled binary',
        why: 'Confirms the binary actually links against the FIPS-validated BoringCrypto module',
        remediation: 'Run verify-boring.sh to check symbols; rebuild if missing',
        nistRef: 'SC-13, SA-11',
      },
      {
        id: 'tn-3',
        name: 'Self-Test Suite Passes',
        status: 'pass',
        severity: 'critical',
        what: 'All Known Answer Tests (KAT) pass for AES-GCM, SHA-256, SHA-384, HMAC, ECDSA, RSA',
        why: 'FIPS 140-2 requires power-on self-tests to verify cryptographic module integrity',
        remediation: 'Run the self-test binary (make selftest); investigate any failures',
        nistRef: 'SC-13, SA-11',
      },
      {
        id: 'tn-4',
        name: 'FIPS-Only Cipher Suites',
        status: 'pass',
        severity: 'critical',
        what: 'Only FIPS-approved TLS cipher suites are available in the cloudflared binary',
        why: 'Non-FIPS ciphers (RC4, DES, 3DES, NULL, EXPORT) must be disabled',
        remediation: 'Verify cipher suite list in self-test output; rebuild with BoringCrypto if non-FIPS suites appear',
        nistRef: 'SC-13, IA-7',
      },
      {
        id: 'tn-5',
        name: 'TLS 1.2 Minimum Enforced',
        status: 'pass',
        severity: 'critical',
        what: 'cloudflared tunnel configuration enforces TLS 1.2 as minimum protocol version',
        why: 'NIST SP 800-52 Rev. 2 requires TLS 1.2+ for all government systems',
        remediation: 'Set min_tls_version: "1.2" in cloudflared-fips.yaml',
        nistRef: 'SC-8, SC-13',
      },
      {
        id: 'tn-6',
        name: 'OS FIPS Mode Enabled',
        status: 'warning',
        severity: 'high',
        what: 'Host operating system is running in FIPS mode (/proc/sys/crypto/fips_enabled = 1)',
        why: 'OS FIPS mode ensures system-wide cryptographic operations use validated modules',
        remediation: 'Enable FIPS mode: fips-mode-setup --enable && reboot (RHEL/CentOS)',
        nistRef: 'SC-13, CM-6',
      },
      {
        id: 'tn-7',
        name: 'Tunnel Credentials Secured',
        status: 'pass',
        severity: 'high',
        what: 'Tunnel credential files are stored with restricted permissions (600) and owned by service account',
        why: 'Tunnel credentials provide persistent access to Cloudflare edge; must be protected',
        remediation: 'chmod 600 on credential files; run cloudflared as dedicated service user',
        nistRef: 'SC-12, AC-3',
      },
      {
        id: 'tn-8',
        name: 'Tunnel Runs as Non-Root',
        status: 'pass',
        severity: 'high',
        what: 'cloudflared process runs as a non-root service account',
        why: 'Principle of least privilege; limits blast radius if process is compromised',
        remediation: 'Create dedicated cloudflared user and configure systemd unit to run as that user',
        nistRef: 'AC-6, CM-6',
      },
      {
        id: 'tn-9',
        name: 'Protocol Selection: QUIC/HTTP2',
        status: 'pass',
        severity: 'medium',
        what: 'Tunnel protocol is configured to use QUIC (preferred) or HTTP/2',
        why: 'Modern protocols provide better performance and multiplexing for tunnel connections',
        remediation: 'Set protocol: quic in cloudflared config (default in recent versions)',
        nistRef: 'SC-8',
      },
      {
        id: 'tn-10',
        name: 'Origin Certificate Validation',
        status: 'pass',
        severity: 'high',
        what: 'cloudflared validates origin server TLS certificates when proxying to HTTPS origins',
        why: 'Prevents man-in-the-middle attacks between tunnel and origin service',
        remediation: 'Set noTLSVerify: false and provide originServerName in ingress rules',
        nistRef: 'SC-8(1), IA-5',
      },
      {
        id: 'tn-11',
        name: 'Grace Period Configured',
        status: 'pass',
        severity: 'medium',
        what: 'Graceful shutdown period is configured to drain connections before stopping',
        why: 'Ensures in-flight requests complete during deployments or restarts',
        remediation: 'Set grace-period in cloudflared config (default: 30s)',
        nistRef: 'CP-10, SC-24',
      },
      {
        id: 'tn-12',
        name: 'Build Manifest Generated',
        status: 'pass',
        severity: 'high',
        what: 'A build manifest with cryptographic provenance is generated for each build',
        why: 'Provides auditable evidence of build inputs, FIPS certificate references, and binary integrity',
        remediation: 'Run make manifest to generate build-manifest.json',
        nistRef: 'SA-11, CM-14',
      },
    ],
  },
  {
    id: 'local-service',
    name: 'Local Service',
    description: 'Origin service security configuration behind the cloudflared tunnel',
    items: [
      {
        id: 'ls-1',
        name: 'Origin Binds to Localhost',
        status: 'pass',
        severity: 'high',
        what: 'Origin service binds only to localhost (127.0.0.1 or ::1), not 0.0.0.0',
        why: 'Prevents direct access bypassing the cloudflared tunnel and its protections',
        remediation: 'Configure origin service to listen on 127.0.0.1 only; use cloudflared ingress for exposure',
        nistRef: 'SC-7, CM-7',
      },
      {
        id: 'ls-2',
        name: 'Origin TLS Enabled',
        status: 'warning',
        severity: 'medium',
        what: 'Origin service uses TLS even for localhost connections from cloudflared',
        why: 'Defense-in-depth: encrypts the local hop between cloudflared and origin',
        remediation: 'Configure origin with TLS certificate; set ingress to https://localhost:PORT',
        nistRef: 'SC-8, SC-13',
      },
      {
        id: 'ls-3',
        name: 'Firewall Restricts Origin',
        status: 'pass',
        severity: 'high',
        what: 'Host firewall rules restrict inbound access to only the cloudflared process/port',
        why: 'Ensures all traffic flows through the authenticated tunnel',
        remediation: 'Configure iptables/nftables to allow inbound only from 127.0.0.1 on service port',
        nistRef: 'SC-7, AC-4',
      },
      {
        id: 'ls-4',
        name: 'Service Hardening Applied',
        status: 'pass',
        severity: 'medium',
        what: 'Origin service follows security hardening guidelines (headers, rate limiting, input validation)',
        why: 'Application-level security is required regardless of network-level protections',
        remediation: 'Apply OWASP hardening guidelines; configure security headers and rate limiting',
        nistRef: 'SI-10, SC-7',
      },
    ],
  },
  {
    id: 'build-supply-chain',
    name: 'Build & Supply Chain',
    description: 'Build pipeline integrity, artifact signing, and software supply chain security',
    items: [
      {
        id: 'bs-1',
        name: 'Reproducible Build Pipeline',
        status: 'pass',
        severity: 'high',
        what: 'Build pipeline uses pinned base images, Go versions, and dependency hashes',
        why: 'Reproducibility enables verification that builds produce expected outputs',
        remediation: 'Pin all versions in Dockerfile.fips; use go.sum for dependency verification',
        nistRef: 'SA-11, CM-14',
      },
      {
        id: 'bs-2',
        name: 'SBOM Generated',
        status: 'pass',
        severity: 'high',
        what: 'Software Bill of Materials (SBOM) in SPDX format is generated for each build',
        why: 'Executive Order 14028 requires SBOM for software sold to federal government',
        remediation: 'Integrate syft or cyclonedx-gomod into build pipeline',
        nistRef: 'SA-11, CM-8',
      },
      {
        id: 'bs-3',
        name: 'Artifact Signing',
        status: 'warning',
        severity: 'high',
        what: 'Build artifacts are signed with a code signing key for integrity verification',
        why: 'Prevents tampering with binaries between build and deployment',
        remediation: 'Integrate cosign or GPG signing into CI pipeline',
        nistRef: 'SA-11, SI-7',
      },
      {
        id: 'bs-4',
        name: 'CI Pipeline Secured',
        status: 'pass',
        severity: 'high',
        what: 'CI/CD pipeline runs in isolated environment with minimal permissions',
        why: 'Compromised CI pipelines can inject malicious code into builds',
        remediation: 'Use ephemeral runners, pin action versions, require PR reviews for workflow changes',
        nistRef: 'SA-11, CM-3',
      },
      {
        id: 'bs-5',
        name: 'Dependency Vulnerability Scanning',
        status: 'pass',
        severity: 'medium',
        what: 'Go dependencies are scanned for known vulnerabilities (govulncheck)',
        why: 'Known vulnerable dependencies must be identified and updated',
        remediation: 'Run govulncheck in CI; add Dependabot or Renovate for automated updates',
        nistRef: 'RA-5, SI-2',
      },
      {
        id: 'bs-6',
        name: 'Container Image Scanning',
        status: 'pass',
        severity: 'medium',
        what: 'Built container images are scanned for OS-level vulnerabilities',
        why: 'Base image vulnerabilities can compromise the runtime environment',
        remediation: 'Integrate Trivy or Grype scanning into CI pipeline',
        nistRef: 'RA-5, CM-6',
      },
    ],
  },
]

export const mockManifest: BuildManifest = {
  schema_version: '1.0.0',
  build_id: '2024.12.2-fips-abc1234',
  timestamp: '2024-12-15T14:30:00Z',
  source: {
    repository: 'https://github.com/cloudflare/cloudflared',
    branch: 'main',
    commit: 'abc1234def5678',
    tag: '2024.12.2',
  },
  platform: {
    build_os: 'linux',
    build_arch: 'amd64',
    target_os: 'linux',
    target_arch: 'amd64',
    builder: 'rhel-ubi9-fips',
  },
  go_version: '1.24.0',
  go_experiment: 'boringcrypto',
  cgo_enabled: true,
  fips_certificates: [
    {
      module: 'BoringCrypto',
      cert_number: '4407',
      level: 'FIPS 140-2 Level 1',
      validated_on: '2023-11-01',
      expires_on: '2028-11-01',
      cmvp_url:
        'https://csrc.nist.gov/projects/cryptographic-module-validation-program/certificate/4407',
    },
  ],
  binary: {
    name: 'cloudflared',
    path: 'build-output/cloudflared',
    sha256: 'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855',
    size: 52428800,
    stripped: false,
  },
  sbom: {
    format: 'spdx-json',
    path: 'build-output/sbom.spdx.json',
    sha256: 'a1b2c3d4e5f67890abcdef1234567890abcdef1234567890abcdef1234567890',
  },
  verification: {
    boring_crypto_symbols: true,
    self_test_passed: true,
    banned_ciphers: [],
    static_linked: false,
  },
}
